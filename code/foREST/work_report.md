# 工作记录


## 11.23

gitlab覆盖率貌似做好了，但是对于同一个API多个分支的覆盖率貌似没做到，更像是API覆盖率，还需要再改改。

遗传算法在刚开始测试时表现并不好，由于采用了贪心的原则，一开始会有更多干扰。但是在多轮测试以后，效果让我有点惊喜，能够通过反馈筛选出较为准确的参数以来

想做动态删减的资源池，但有点不知道怎么改。难点在于要基于什么method建立资源池？基于post的话，数据库里原有的资源在资源池中就无法反馈。
基于get的话，又存在 GET /projects 和 GET /projects/{id} 两种情况。建立的资源池可能不全。
是否可以基于结点建立资源池？但这样必须考虑上下结点的联系，如POST /projects 与 DELETE /projects/{id} 这是父子结点，但两者对同一资源进行操作。

而且不能跟任何一个项目过于耦合，头疼啊


## 11.24

写了一下依赖文件，便于在机器上移植代码，现在基本上换个环境也都能直接执行了，但是redis还是需要另外配，后面如果需要的话再想办法把
redis-server也集成进来

写了一下环境布置，GitLab那个代码覆盖率的精度只有四位数字 （0.00%），所以导致一些小分支的代码覆盖情况变化不会体现出来，那实验环境这块应该没啥问题了

还剩下动态资源池这块，我想了一个办法：既然我现在已经知道了我每次取资源都去哪里取，那么如果我运行delete成功了就把对应的资源删了。但是这样有个问题
就是可能存在多个API的资源池里的资源需要删，那这样删就删不干净了，现有的论文里也没有类似的案例

## 11.25

今天改进了一下资源池，原先的资源池是以响应为单位的，是将整个响应完整的存储下来，形成响应列表，但当长时间测试，响应列表会越来越长。
现在的资源池是以实例为单位


## 11.26

悲伤的一天，覆盖率有个bug，我测gitlab所有api的时候得到这么一个令人悲伤的情况，返工

另外，我发现测的时候，无效请求的比例很高，经过排查，我发现是API文档的原因，当时的文档没有经过人工校验，存在很多问题，我尝试在网上找文档，但是大家都遇到相似的情况，或许我该手工校验所有API？
找到了新加坡南洋理工大学的同行hhh
![image](https://user-images.githubusercontent.com/71680354/143561734-15e27358-e388-44ea-bb74-75f7c09da723.png)

我手工校验过project API 能有25%左右的有效请求比例。而跑所有gitlab的api只有5%的有效请求。
另外，我发现我的方法的一些问题，因为API太多了，有600多个，采用贪心的算法时，有的参数甚至会依赖几百个参数（这就是之前天宇遇到的情况）会有太多的无效依赖。或许我该在参数依赖中也加入树依赖的影响？

最近学校疫情，老师同学也都比较忙，希望大家一切安好！


## 11.30 

覆盖率工具可用，但是在我测试后出现一个问题，相同的path的method共享覆盖率，无语子，而且失败跟成功增加的覆盖率是一样的。
![W%@6AM76CM{~M@4OP_I{AE3](https://user-images.githubusercontent.com/71680354/144161027-bd7f0920-6d0a-4d1c-a99d-c3a32862f0cf.png)

这两天没有更新report，主要是做的不是与代码相关的，我今天跑restler实验，但是出现了一个很奇怪的问题，restler无法访问我的服务，但是我本地可以访问服务，发现有人出现了与我共同的问题但没有解决不知道是不是restler的bug。每次看restler代码的issue，都会想，什么时候我们的工具也能有这么多人用然后大家一起交流。

另外今天做了一下华为的Monthly report


## 12.1

十二月，新的一个月，这个月无论如何要把论文完成。进度太慢，晚上睡觉中途都得醒好几次，不能再拖了。

之前我的问题，在服务规模足够庞大时，如完整的gitlab API有600多个，这种情况下，参数依赖会非常复杂。我突然意识到，restler也存在这个问题，我原本想的是跟restler论文里写的一样，
将服务拆开来测，但是，树状结构不就是为了应对这个问题的么。restler做不了，我们能做。没有API的官方文档，我就人工手写一份，无论如何都要弄好。

要不要以method来区别测试用例的生成呢？GET、DELETE、PUT、PATCH是幂等的，POST不是幂等的，这两者要做个区分吧，或者说对五种请求都分别设计？
比如：GET参数相同的话不管发送对服务端都不应该有修改，返回的值也都相同，可以对此进行验证？


## 12.2

今天开始手写gitlab的api文档，这个问题拖了太久了。实验的话我很有信心，只要文档准确API覆盖率会很高，但是现在有遇到一个问题，
依赖方面的问题，原先也有提过的参数间的依赖。比如某个hook是project1的，那么执行hook1时，需要project1的id和这个hook的id，
但是我们取值的时候这两者之间没有关联，所以就跑不出来。这个问题我在想是不是能够通过序列来解决，但是效果不能保证。但这个问题又是一个很普遍的问题，直接决定了测试的深度。毕竟深层的api取值都是有关联的。

通过序列来解决是指，不再按照目前的树bfs，而是按照树生成序列，取值的时候就从这里取。但是生成序列时，有一些参数是在其他分支上，这时候要不要取呢？如果取的话我们就与这个策略本身矛盾了。

## 12.3

昨天的问题跟华为这边的同事讨论了一下，他在适配过程中也有遇到这种情况，但是目前也没有解决办法。

实验方面，我自认为我原先提的需求已经写得非常清楚了。我今天跑实验出来的曲线是这样的。经过沟通才发现，gitlab代码执行时会缓存代码到redis，而
他读取的覆盖率是缓存的覆盖率，并不是实际执行的覆盖率。
![T@8LB%U{N7BQXFNJS{8_(O](https://user-images.githubusercontent.com/71680354/144589473-ff5a96b6-1c08-43cb-8b29-4f4428a4404f.png)
![MPVM Y3_)T HHH5FIABVUK](https://user-images.githubusercontent.com/71680354/144589497-b579450c-e113-4781-a5af-dca9b8e513c9.png)

restler的问题https://github.com/microsoft/restler-fuzzer/issues/283

![image](https://user-images.githubusercontent.com/71680354/144589822-bb713838-ed62-4a73-82e9-e5337322200a.png)

gitlabAPI文档我更新在另一个项目里

## 12.5

今天那个覆盖率工具总算是弄好了，测试了几个接口，覆盖率变化看起来都没啥问题，但不知道有没有隐藏的坑。
今天跑实验的时候发现接口覆盖率不对，找bug找了好久没找到，明天再看看叭


## 12.6

今天做了一个初步的实验。先规划一下需要做哪些实验吧：

分析的时候发现我用代码生成的请求，只要结构体里放数据就跑不通，不懂为什么，明天再看看，如果这个能解决覆盖率还能上一个台阶

### 实验需要的数据对比：
* RESTler：成功访问的API占比、找到的bug数量、代码覆盖行数对比、代码覆盖率对比
* foREST：成功访问的API占比、找到的bug数量、代码覆盖行数对比、代码覆盖率对比
### 测试服务
#### 一、gitlab
* restler论文中跑过的分支  foREST vs RESTler vs evomaster
* gitlab所有API  foREST vs RESTler vs evomaster
### 二、wordpress
* 所有API foREST vs RESTler vs evomaster

## 12.15
时间过得很快，这个月过去一半了。这段时间在琢磨evomaster的实现手段，后来重新搭建gitlab跑实验，发现与之前的实验结果有出入，应该是之前测的时候
![image](https://user-images.githubusercontent.com/71680354/146371820-5e66a9a3-a986-4e3a-b573-e89e5e7d5033.png)

误操作了gitlab，正确的实验结果如图，与我预想的区别不大，但evomaster是发了十七万条请求所达到的结果，我们的速度只有一万多，速度方面差距确实很大
我还是想把foREST2.0写出来，最近写的时候遇到问题，主要还是资源池的调用和匹配问题，这个工作感觉很复杂，涉及到nlp的一些知识
